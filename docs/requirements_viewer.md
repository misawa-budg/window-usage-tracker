# Windows版スクリーンタイム（Viewer）要件定義

> このファイルは **Viewer の要件定義書** です。

## 概要
Collector が蓄積した SQLite ログを読み取り、アプリ利用状況を視覚的に確認できる GUI を提供する。

## スコープ
- 対象OS: Windows 11
- 対象フレームワーク: WinUI 3（Windows App SDK）
- 対象期間: `24h` / `1week`
- 対象状態: `Active / Open / Minimized`
- 更新方式: リアルタイム更新は行わず、ユーザーの更新操作で再読込する
- 画面構成: 単一画面内に `一覧タイムライン`（上段）と `アプリ別タイムライン`（下段）を配置

## データ入力
- 入力元: Collector が出力した SQLite（`app_events`）
- 利用カラム: `state_start_utc`, `state_end_utc`, `exe_name`, `state`
- DBアクセスは読み取り専用

## 機能要件
- 期間切替（`24h` / `1week`）ができること
- 更新ボタンでDBを再読込し、画面を再構築できること
- 一覧タイムラインを表示できること
  - `24h`: `Running` 1レーンを00:00-24:00の横棒で表示
  - `1week`: 日付ごとに `Running` 1行、各行を00:00-24:00スケールで表示（1週間分）
  - 同一時刻に複数アプリがある場合は縦分割表示し、並び順はアプリ名昇順
  - 凡例として上位アプリ色を表示する（上限あり、超過は `Other`）
- アプリ別タイムラインを表示できること
  - `24h`: アプリごとに1行、各行で `Active / Open / Minimized` を同一色相の濃淡で表示
  - `1week`: アプリ選択で対象を絞り、選択アプリの日付行表示（各日00:00-24:00スケール）
  - 凡例は状態トーン（`Active/Open/Minimized`）を表示すること
- 行ごとの `Total`（HH:mm）を表示できること

## 集計ルール
- 区間重なりで利用秒数を算出する（期間をまたぐイベントを正しく計算する）
- 集計バケット:
  - `24h`: 5分（`BucketSize = 5m`）
  - `1week`: 1時間（`BucketSize = 1h`）
- `24h` は「当日00:00〜翌日00:00（ローカル）」を対象にする
- `1week` は「当日を含む直近7日（ローカル日境界）」を対象にする
- 表示対象は累計5分以上のアプリのみ
- 日次行の表示は24時間幅を100%として描画する
- 保存時刻はUTCだが、表示ラベルはローカル時刻で扱う

## 非機能要件
- 更新操作中にUIが固まらないこと（非同期で再読込）
- 初期版は単一ユーザー・ローカル利用を前提とする
- 最小ウィンドウサイズを持つこと（`1100 x 700`）
- 横幅に応じて時刻ラベル表記を切替できること（`00:00` 表記と簡易表記）

## 対象外（初期版）
- 自動更新（秒単位のライブ反映）
- 複数端末同期
- URLや詳細タイトルの高度分析
- 高度なドリルダウン分析（ウィンドウタイトル別、URL別など）
